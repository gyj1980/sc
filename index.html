<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ç›´æ’­æºæ–‡ä»¶ä¸Šä¼ å·¥å…·ï¼ˆGitHubç‰ˆï¼‰</title>
<style>
/* ä¿æŒåŸæœ‰æ ·å¼ä¸å˜ */
*{box-sizing:border-box}
body{margin:0;font:14px/1.5 "Microsoft YaHei";background:#f9fafb;color:#374151;display:flex;flex-direction:column;min-height:100vh}
.top-nav,.footer-links{background:#4285f4;text-align:center;padding:10px 0;font-size:0}
.top-nav a,.footer-links a{color:#fff;font-size:13px;margin:0 8px;padding:4px 6px;text-decoration:none}
.top-nav a:hover,.footer-links a:hover{text-decoration:underline}
.container{width:100%;max-width:800px;margin:0 auto 24px;padding:16px;background:#fff;border-radius:0 0 8px 8px;box-shadow:0 0 6px rgba(0,0,0,.04);flex:1}
h2{font-size:18px;text-align:center;margin:0 0 16px}
label{font-size:14px;margin-bottom:6px;display:block}
input[type=text],textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:15px;resize:none}
textarea{min-height:140px}
button{border:none;border-radius:6px;padding:12px 0;font-size:15px;font-weight:600;color:#fff;cursor:pointer;transition:filter .2s;margin-right:8px}
button:hover{filter:brightness(1.1)}
.enc{background:#f093fb}.copy{background:#f7b801}.clear{background:#ef476f}.down{background:#4895ef}
.desc{color:#64748b;text-align:center;margin-bottom:20px;font-size:14px}
.section{margin-bottom:20px;padding:20px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0}
.file-info{font-size:12px;color:#64748b;margin-top:8px}
.action-buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}
.link-box{display:flex;gap:10px;margin-top:10px}
.link-box input{flex:1;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}
.msg{padding:12px;border-radius:6px;margin-top:15px;font-weight:500;display:none}
.msg.success{background:rgba(6,214,160,.2);color:#057a5c;border-left:4px solid #06d6a0}
.msg.error{background:rgba(239,71,111,.2);color:#b71540;border-left:4px solid #ef476f}

/* é…ç½®åŒºåŸŸ */
.config-section{background:#fff3cd;border:1px solid #ffeaa7;border-radius:6px;padding:15px;margin-bottom:20px}
.config-section h3{margin-top:0;color:#856404}
.config-section input{width:100%;margin:8px 0;padding:8px}
</style>
</head>
<body>

<div class="top-nav">
    <a href="index.html">æˆ‘çš„ä¸»é¡µ</a>
    <a href="1.html">æ ¼å¼è½¬æ¢</a>
    <a href="2.html">åŠ å¯†å·¥å…·</a>
    <a href="pl.html">æ‰¹é‡å·¥å…·</a>
</div>

<div class="container">
    <h2>ç›´æ’­æºæ–‡ä»¶ä¸Šä¼ ä¸ç¼–è¾‘å·¥å…·ï¼ˆGitHub APIç‰ˆï¼‰</h2>
    
    <!-- é…ç½®åŒºåŸŸ -->
    <div class="config-section">
        <h3>ğŸ”§ GitHubé…ç½®</h3>
        <label>ä»“åº“åœ°å€ï¼ˆå¦‚ï¼šusername/repoï¼‰</label>
        <input type="text" id="repoName" placeholder="gyjune/live-source">
        <label>GitHub Tokenï¼ˆéœ€è¦repoæƒé™ï¼‰</label>
        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxx">
        <button class="down" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
        <p class="file-info">é…ç½®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
    </div>

    <p class="desc">æ”¯æŒä¸Šä¼ TXT/M3Uæ–‡ä»¶åç¼–è¾‘å†…å®¹ï¼Œæˆ–ç›´æ¥è¾“å…¥å†…å®¹ç”Ÿæˆæ–‡ä»¶ã€‚å†…å®¹å°†ä¿å­˜åˆ°GitHubä»“åº“çš„/1/gyj.txtæ–‡ä»¶ä¸­ã€‚</p>

    <!-- æ–‡ä»¶ä¸Šä¼  -->
    <div class="section">
        <label>ğŸ“ é€‰æ‹©æ–‡ä»¶</label>
        <input type="file" id="fileUpload" accept=".txt,.m3u">
        <p class="file-info">æ”¯æŒ.txtå’Œ.m3uæ ¼å¼æ–‡ä»¶ï¼Œæœ€å¤§ä¸è¶…è¿‡5MB</p>
        <div class="btn-grid">
            <button class="enc" onclick="loadFile()">åŠ è½½æ–‡ä»¶</button>
        </div>
    </div>

    <!-- ç¼–è¾‘åŒº -->
    <div class="section">
        <label>âœï¸ ç¼–è¾‘æ–‡ä»¶</label>
        <textarea id="content" placeholder="è¯·è¾“å…¥æˆ–ç²˜è´´ç›´æ’­æºå†…å®¹..."></textarea>
        <div class="action-buttons">
            <button class="down" onclick="saveFile()">ä¿å­˜åˆ°GitHubä»“åº“</button>
            <button class="clear" onclick="clearContent()">æ¸…ç©ºå†…å®¹</button>
        </div>
    </div>

    <!-- é“¾æ¥å±•ç¤º -->
    <div class="section" id="linkArea" style="display:none">
        <label>ğŸ”— æ–‡ä»¶é“¾æ¥</label>
        <div class="link-box">
            <input type="text" id="fileLink" readonly>
            <button class="copy" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
        </div>
    </div>

    <!-- æç¤º -->
    <div id="msg" class="msg"></div>
</div>

<div class="footer-links">
    <a onclick="window.open('https://link3.cc/gyjune')">æˆ‘çš„å·¥å…·ç®±</a>
    <a onclick="alert('é‚®ç®±ï¼šgyjune@126.com')">æˆ‘çš„é‚®ç®±</a>
    <a onclick="window.open('https://weibo.com/u/1771411553')">æˆ‘çš„å¾®åš</a>
    <a href="1.html">æ ¼å¼è½¬æ¢</a>
    <a href="zby.html">ç›´æ’­æºç”Ÿæˆå·¥å…·</a>
    <a href="sc.html">ç›´æ’­æºä¸Šä¼ å·¥å…·</a>
</div>
<div class="copyright">Copyright Â© 2025 å¤šåŠŸèƒ½ç½‘ç«™ | ç‰ˆæƒæ‰€æœ‰</div>

<script>
// é…ç½®å­˜å‚¨
const CONFIG_KEY = 'github_config';
const FILE_PATH = '1/gyj.txt'; // å›ºå®šè·¯å¾„

// è·å–é…ç½®
function getConfig() {
    const config = localStorage.getItem(CONFIG_KEY);
    return config ? JSON.parse(config) : { repoName: '', token: '' };
}

// ä¿å­˜é…ç½®
function saveConfig() {
    const repoName = document.getElementById('repoName').value.trim();
    const token = document.getElementById('githubToken').value.trim();
    
    if (!repoName || !token) {
        showMsg('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯', 'error');
        return;
    }
    
    localStorage.setItem(CONFIG_KEY, JSON.stringify({ repoName, token }));
    showMsg('é…ç½®å·²ä¿å­˜', 'success');
}

// åŠ è½½é…ç½®åˆ°è¡¨å•
function loadConfig() {
    const config = getConfig();
    document.getElementById('repoName').value = config.repoName || '';
    document.getElementById('githubToken').value = config.token || '';
}

// GitHub API è°ƒç”¨
async function githubAPI(endpoint, method = 'GET', body = null) {
    const config = getConfig();
    if (!config.repoName || !config.token) {
        throw new Error('è¯·å…ˆé…ç½®GitHubä¿¡æ¯');
    }
    
    const url = `https://api.github.com/repos/${config.repoName}${endpoint}`;
    const options = {
        method,
        headers: {
            'Authorization': `token ${config.token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        }
    };
    
    if (body) {
        options.body = JSON.stringify(body);
    }
    
    const response = await fetch(url, options);
    if (!response.ok) {
        throw new Error(`GitHub APIé”™è¯¯: ${response.status}`);
    }
    
    return response.json();
}

// è¯»å–æ–‡ä»¶å†…å®¹
async function readFile() {
    try {
        const data = await githubAPI(`/contents/${FILE_PATH}`);
        // Base64è§£ç 
        const content = atob(data.content.replace(/\s/g, ''));
        return content;
    } catch (error) {
        // æ–‡ä»¶ä¸å­˜åœ¨æ—¶è¿”å›ç©ºå†…å®¹
        if (error.message.includes('404')) {
            return '# æš‚æ— å†…å®¹ï¼Œè¯·ç¼–è¾‘åä¿å­˜';
        }
        throw error;
    }
}

// å†™å…¥æ–‡ä»¶å†…å®¹
async function writeFile(content, message = 'æ›´æ–°ç›´æ’­æºæ–‡ä»¶') {
    // å…ˆè·å–æ–‡ä»¶SHAï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    let sha = null;
    try {
        const existing = await githubAPI(`/contents/${FILE_PATH}`);
        sha = existing.sha;
    } catch (error) {
        // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œshaä¿æŒnull
    }
    
    const data = {
        message: message,
        content: btoa(unescape(encodeURIComponent(content))), // Base64ç¼–ç 
        path: FILE_PATH
    };
    
    if (sha) {
        data.sha = sha;
    }
    
    return await githubAPI(`/contents/${FILE_PATH}`, 'PUT', data);
}

// æ–‡ä»¶æ“ä½œå‡½æ•°
async function loadFile() {
    const f = document.getElementById('fileUpload').files[0];
    if (!f) { showMsg('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error'); return; }
    if (f.size > 5 * 1024 * 1024) { showMsg('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB', 'error'); return; }
    
    const r = new FileReader();
    r.onload = e => {
        document.getElementById('content').value = e.target.result;
        showMsg('æ–‡ä»¶å†…å®¹å·²åŠ è½½', 'success');
    };
    r.readAsText(f);
}

async function saveFile() {
    const c = document.getElementById('content').value.trim();
    if (!c) { showMsg('å†…å®¹ä¸èƒ½ä¸ºç©º', 'error'); return; }
    
    showMsg('æ­£åœ¨ä¿å­˜åˆ°GitHub...', 'success');
    
    try {
        await writeFile(c, 'æ›´æ–°ç›´æ’­æºæ–‡ä»¶');
        
        // ç”Ÿæˆæ–‡ä»¶é“¾æ¥
        const config = getConfig();
        const fileUrl = `https://raw.githubusercontent.com/${config.repoName}/main/${FILE_PATH}`;
        document.getElementById('fileLink').value = fileUrl;
        document.getElementById('linkArea').style.display = 'block';
        
        showMsg('âœ… æ–‡ä»¶å·²ä¿å­˜åˆ°GitHubä»“åº“', 'success');
    } catch (error) {
        showMsg('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
    }
}

function clearContent() {
    document.getElementById('content').value = '';
    showMsg('ç¼–è¾‘æ¡†å·²æ¸…ç©º', 'success');
}

function copyLink() {
    const i = document.getElementById('fileLink');
    i.select();
    document.execCommand('copy');
    showMsg('âœ… é“¾æ¥å·²å¤åˆ¶', 'success');
}

function showMsg(text, type) {
    const m = document.getElementById('msg');
    m.textContent = text;
    m.className = 'msg ' + type;
    m.style.display = 'block';
    setTimeout(() => m.style.display = 'none', 3000);
}

// é¡µé¢åŠ è½½æ—¶
window.onload = async () => {
    loadConfig();
    
    // å°è¯•è¯»å–å·²æœ‰å†…å®¹
    try {
        const content = await readFile();
        document.getElementById('content').value = content;
    } catch (error) {
        console.log('è¯»å–æ–‡ä»¶å¤±è´¥:', error);
    }
};
</script>
</body>
</html>